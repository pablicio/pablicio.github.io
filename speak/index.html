<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Speak ‚Äî Markdown TTS</title>
<meta name="theme-color" content="#4f46e5"/>
<style>
:root{
  --bg:#071024;
  --surface:#081427;
  --card:#0f1728;
  --muted:#9aa4b2;
  --accent:#4f46e5;
  --accent-600:#4338ca;
  --accent-300:#93c5fd;
  --highlight-bg: rgba(255,255,255,0.06);
  --highlight-text: #eef2ff;
  --glass:rgba(255,255,255,0.03);
}

/* reset / layout */
*{box-sizing:border-box;margin:0;padding:0;font-family:Inter,system-ui,Roboto,Arial,sans-serif;color:#e6eef8}
html,body{height:100%;overflow:hidden;background:linear-gradient(180deg,#071024 0%, #081427 100%);-webkit-font-smoothing:antialiased;}
body{display:flex;flex-direction:column;}

/* header fixo */
.header{
  position:fixed;top:0;left:0;right:0;z-index:50;
  display:flex;align-items:center;justify-content:space-between;
  padding:14px 16px;
  background:linear-gradient(90deg, rgba(255,255,255,0.02), transparent);
  border-bottom:1px solid rgba(255,255,255,0.03);
}
.app-title h1{font-size:16px;font-weight:700;color:#f8fafc;}
.app-title p{font-size:12px;color:var(--muted)}

/* settings button */
.icon-btn{width:42px;height:42px;border-radius:12px;border:none;background:var(--glass);
  display:inline-flex;align-items:center;justify-content:center;color:var(--accent-300);cursor:pointer;
  box-shadow:0 6px 24px rgba(15,23,42,0.35);
}

/* file card fixo */
.file-card{
  position:fixed;top:66px;left:0;right:0;z-index:45;
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border-bottom:1px solid rgba(255,255,255,0.03);
  padding:12px 16px;
  box-shadow:0 8px 30px rgba(2,6,23,0.35);
}
.file-row{display:flex;gap:10px;align-items:center;justify-content:space-between}
.file-btn{
  background:linear-gradient(90deg,var(--accent),var(--accent-600));
  color:white;padding:10px 14px;border-radius:12px;border:none;font-weight:700;cursor:pointer;
  display:inline-flex;gap:8px;align-items:center;box-shadow:0 8px 30px rgba(79,70,229,0.18)
}
.file-name{color:var(--muted);font-size:13px;flex:1;text-align:left;margin-left:12px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:color .3s, text-shadow .3s;}
.file-name.flash{color:#c7d2fe;text-shadow:0 0 6px rgba(147,197,253,0.6);}
.small-note{font-size:12px;color:var(--muted);margin-top:8px}

/* preview √°rea rol√°vel */
.preview{
  position:fixed;
  top:150px; /* abaixo do header + file card */
  bottom:84px; /* acima do footer */
  left:0;right:0;
  overflow-y:auto;
  -webkit-overflow-scrolling:touch;
  touch-action:pan-y;
  overscroll-behavior:contain;
  padding:16px;
  scroll-behavior:smooth;
}
.chunk{
  background:linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
  border-radius:10px;padding:12px;margin-bottom:8px;cursor:pointer;
  transition:all .18s ease;opacity:.95;
}
.chunk:hover{background:rgba(255,255,255,0.02);opacity:1}
.chunk.current{
  background: var(--highlight-bg);
  color: var(--highlight-text);
  border-left:4px solid rgba(99,102,241,0.95);
  animation: pulseGlow 2s ease-in-out infinite;
}
@keyframes pulseGlow {
  0%, 100% { box-shadow: 0 6px 18px rgba(99,102,241,0.35); }
  50% { box-shadow: 0 6px 24px rgba(99,102,241,0.65); }
}

/* footer fixo */
.footer{
  position:fixed;left:12px;right:12px;bottom:12px;
  padding:12px;border-radius:16px;
  background:linear-gradient(180deg, rgba(10,14,24,0.9), rgba(8,10,20,0.85));
  box-shadow:0 12px 40px rgba(2,6,23,0.6);
  display:flex;align-items:center;gap:12px;z-index:60;
  backdrop-filter: blur(6px);
}
.fab{width:54px;height:54px;border-radius:999px;border:none;background:linear-gradient(180deg,var(--accent),var(--accent-600));
  color:white;font-weight:700;display:inline-flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 12px 30px rgba(79,70,229,0.28);cursor:pointer}
.small-btn{width:44px;height:44px;border-radius:10px;border:none;background:rgba(255,255,255,0.03);color:var(--muted);display:inline-flex;align-items:center;justify-content:center;cursor:pointer}

@media(min-width:720px){
  .preview{left:12px;right:12px;}
}
</style>
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>

<header class="header">
  <div class="app-title">
    <h1>Speak</h1>
    <p>Leitura por voz de Markdown</p>
  </div>
  <button id="gearBtn" class="icon-btn" title="Configura√ß√µes">‚öôÔ∏è</button>
</header>

<div class="file-card">
  <div class="file-row">
    <label for="fileIn" class="file-btn" title="Carregar markdown">üìÇ Carregar Markdown</label>
    <input id="fileIn" type="file" accept=".md,.markdown,.txt" style="display:none"/>
    <div id="fileName" class="file-name">Nenhum arquivo carregado</div>
  </div>
  <div class="small-note">Toque em qualquer trecho para pular para ele</div>
</div>

<div id="preview" class="preview"></div>

<div class="footer">
  <button id="prevBtn" class="small-btn">‚óÄÔ∏é</button>
  <button id="playBtn" class="fab">‚ñ∂</button>
  <button id="pauseBtn" class="small-btn">‚è∏</button>
  <button id="nextBtn" class="small-btn">‚ñ∂Ô∏é</button>
  <button id="stopBtn" class="small-btn">‚èπ</button>
</div>

<script>
const fileIn=document.getElementById('fileIn');
const preview=document.getElementById('preview');
const fileNameEl=document.getElementById('fileName');
const playBtn=document.getElementById('playBtn');
const pauseBtn=document.getElementById('pauseBtn');
const stopBtn=document.getElementById('stopBtn');
const prevBtn=document.getElementById('prevBtn');
const nextBtn=document.getElementById('nextBtn');
let chunks=[],chunkHtml=[],currentIndex=0,utterance=null,voices=[];

function renderChunks(md){
  const parts=md.split(/\n{2,}/).filter(Boolean);
  chunks=parts;
  chunkHtml=parts.map(p=>marked.parse(p));
  preview.innerHTML='';
  chunkHtml.forEach((html,i)=>{
    const div=document.createElement('div');
    div.className='chunk';div.dataset.index=i;div.innerHTML=html;
    preview.appendChild(div);
  });
}
function speakIndex(i){
  if(i<0||i>=chunks.length)return;
  speechSynthesis.cancel();
  utterance=new SpeechSynthesisUtterance(chunks[i]);
  utterance.onstart=()=>highlight(i);
  utterance.onend=()=>{if(i<chunks.length-1)setTimeout(()=>speakIndex(i+1),300);}
  speechSynthesis.speak(utterance);
}
function highlight(i){
  preview.querySelectorAll('.chunk').forEach(c=>c.classList.remove('current'));
  const el=preview.querySelector(`.chunk[data-index='${i}']`);
  if(el){el.classList.add('current');el.scrollIntoView({behavior:'smooth',block:'center'});}
}
fileIn.onchange=async e=>{
  const f=e.target.files[0];
  if(!f)return;
  const txt=await f.text();
  renderChunks(txt);
  fileNameEl.textContent=f.name;
  fileNameEl.classList.add('flash');setTimeout(()=>fileNameEl.classList.remove('flash'),700);
}
preview.onclick=e=>{
  const c=e.target.closest('.chunk');
  if(c){currentIndex=+c.dataset.index;speakIndex(currentIndex);}
}
playBtn.onclick=()=>speakIndex(currentIndex);
pauseBtn.onclick=()=>speechSynthesis.pause();
stopBtn.onclick=()=>speechSynthesis.cancel();
prevBtn.onclick=()=>{currentIndex=Math.max(0,currentIndex-1);speakIndex(currentIndex);}
nextBtn.onclick=()=>{currentIndex=Math.min(chunks.length-1,currentIndex+1);speakIndex(currentIndex);}
</script>
</body>
</html>
